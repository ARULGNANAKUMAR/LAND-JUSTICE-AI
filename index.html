<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Land Justice AI ¬∑ Complete AI-Powered System</title>
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.128.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.128.0/examples/jsm/"
            }
        }
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
        }

        :root {
            --gov-bg: #0a0f1e;
            --gov-card: #141b2b;
            --gov-accent: #2a6df4;
            --gov-glow: #4d8cff;
            --citizen-bg: #f5f9ff;
            --citizen-card: #ffffff;
            --citizen-accent: #0284c7;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
            --dark: #0f172a;
            --light: #f8fafc;
            --ai-purple: #8b5cf6;
            --ai-glow: #c084fc;
        }

        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Inter', sans-serif;
            background: var(--gov-bg);
            color: white;
            transition: background 0.5s ease;
        }

        body.citizen-mode {
            background: var(--citizen-bg);
            color: var(--dark);
        }

        #app {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: grid;
            grid-template-rows: auto 1fr auto;
            grid-template-columns: 300px 1fr 340px;
            grid-template-areas: 
                "header header header"
                "sidebar main rightpanel"
                "footer footer footer";
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Header */
        .header {
            grid-area: header;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(12px);
            border-bottom: 2px solid var(--gov-accent);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
            z-index: 100;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .logo-icon {
            font-size: 2rem;
            filter: drop-shadow(0 0 10px var(--gov-glow));
            animation: pulse 2s infinite;
        }

        .mode-toggle {
            display: flex;
            gap: 8px;
            background: rgba(0, 0, 0, 0.3);
            padding: 4px;
            border-radius: 60px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .mode-btn {
            padding: 10px 28px;
            border-radius: 40px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            background: transparent;
            color: #94a3b8;
            transition: all 0.3s;
        }

        .mode-btn.active {
            background: var(--gov-accent);
            color: white;
            box-shadow: 0 0 20px var(--gov-glow);
        }

        .demo-btn {
            background: linear-gradient(135deg, #f59e0b, #dc2626);
            color: white;
            border: none;
            padding: 10px 24px;
            border-radius: 40px;
            font-weight: 600;
            cursor: pointer;
            animation: pulse 2s infinite;
            letter-spacing: 0.5px;
        }

        .privacy-badge {
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid var(--success);
            color: var(--success);
            padding: 6px 16px;
            border-radius: 30px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        /* Sidebar */
        .sidebar {
            grid-area: sidebar;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(12px);
            border-right: 1px solid rgba(42, 109, 244, 0.3);
            padding: 20px 16px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--gov-accent) transparent;
        }

        .sidebar::-webkit-scrollbar {
            width: 6px;
        }

        .sidebar::-webkit-scrollbar-thumb {
            background: var(--gov-accent);
            border-radius: 10px;
        }

        .citizen-mode .sidebar {
            background: rgba(255, 255, 255, 0.9);
        }

        /* Main View */
        .main-view {
            grid-area: main;
            position: relative;
            overflow: hidden;
        }

        #canvas-container {
            width: 100%;
            height: 100%;
        }

        /* Right Panel */
        .right-panel {
            grid-area: rightpanel;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(12px);
            border-left: 1px solid rgba(42, 109, 244, 0.3);
            padding: 20px 16px;
            overflow-y: auto;
        }

        .citizen-mode .right-panel {
            background: rgba(255, 255, 255, 0.9);
        }

        /* Footer */
        .footer {
            grid-area: footer;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(12px);
            border-top: 1px solid rgba(42, 109, 244, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 24px;
            font-size: 0.9rem;
        }

        .emotional-message {
            color: var(--gov-glow);
            font-style: italic;
            animation: glow 3s infinite;
            font-weight: 500;
        }

        .team-credit {
            color: #94a3b8;
            font-size: 0.8rem;
        }

        /* Glass Card */
        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            padding: 20px;
            border: 1px solid rgba(42, 109, 244, 0.3);
            margin-bottom: 20px;
            transition: all 0.3s;
        }

        .glass-card:hover {
            border-color: var(--gov-glow);
            box-shadow: 0 0 30px rgba(42, 109, 244, 0.2);
            transform: translateY(-2px);
        }

        .citizen-mode .glass-card {
            background: white;
            border: 1px solid var(--citizen-accent);
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
        }

        /* AI Chatbot Container */
        .chat-container {
            position: fixed;
            bottom: 100px;
            right: 30px;
            width: 380px;
            height: 550px;
            background: rgba(20, 30, 50, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 30px;
            border: 2px solid var(--ai-purple);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            z-index: 10000;
            box-shadow: 0 20px 60px rgba(139, 92, 246, 0.4);
            transition: all 0.3s;
            resize: both;
            min-width: 300px;
            min-height: 400px;
        }

        .chat-header {
            padding: 18px 20px;
            background: linear-gradient(135deg, var(--ai-purple), #4f46e5);
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: move;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .chat-header h3 {
            flex: 1;
            font-size: 1.1rem;
        }

        .chat-header button {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s;
        }

        .chat-header button:hover {
            background: rgba(255,255,255,0.3);
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .message {
            max-width: 85%;
            padding: 12px 16px;
            border-radius: 18px;
            animation: messageSlide 0.3s ease;
            position: relative;
            font-size: 0.95rem;
            line-height: 1.4;
        }

        .message.user {
            background: linear-gradient(135deg, var(--ai-purple), #4f46e5);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 4px;
        }

        .message.bot {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--ai-purple);
            align-self: flex-start;
            border-bottom-left-radius: 4px;
        }

        .message.bot .rag-badge {
            display: flex;
            gap: 8px;
            font-size: 0.7rem;
            color: var(--ai-glow);
            margin-bottom: 8px;
            padding: 4px 8px;
            background: rgba(139, 92, 246, 0.2);
            border-radius: 20px;
        }

        .chat-input-area {
            padding: 16px;
            display: flex;
            gap: 10px;
            border-top: 1px solid rgba(255,255,255,0.1);
            background: rgba(0,0,0,0.2);
        }

        .chat-input {
            flex: 1;
            background: rgba(255,255,255,0.1);
            border: 1px solid var(--ai-purple);
            border-radius: 30px;
            padding: 12px 18px;
            color: white;
            font-size: 0.95rem;
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--ai-glow);
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.3);
        }

        .chat-send {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--ai-purple), #4f46e5);
            border: none;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .chat-send:hover {
            transform: scale(1.1) rotate(15deg);
            box-shadow: 0 0 30px var(--ai-glow);
        }

        .chat-toggle {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 65px;
            height: 65px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--ai-purple), #4f46e5);
            border: 3px solid white;
            color: white;
            font-size: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 9999;
            box-shadow: 0 10px 30px rgba(139, 92, 246, 0.5);
            transition: all 0.3s;
            animation: pulse 2s infinite;
        }

        .chat-toggle:hover {
            transform: scale(1.1);
        }

        /* Inputs */
        .search-input {
            width: 100%;
            padding: 14px 18px;
            background: rgba(255,255,255,0.1);
            border: 1px solid var(--gov-accent);
            border-radius: 40px;
            color: white;
            font-size: 0.95rem;
            transition: all 0.3s;
            margin-bottom: 12px;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--gov-glow);
            box-shadow: 0 0 20px rgba(42, 109, 244, 0.3);
        }

        .citizen-mode .search-input {
            background: white;
            color: var(--dark);
            border: 1px solid #cbd5e1;
        }

        .district-select {
            width: 100%;
            padding: 14px 18px;
            background: rgba(255,255,255,0.1);
            border: 1px solid var(--gov-accent);
            border-radius: 40px;
            color: white;
            font-size: 0.95rem;
            margin-bottom: 16px;
        }

        .citizen-mode .district-select {
            background: white;
            color: var(--dark);
        }

        /* Filter Tags */
        .filter-tags {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .filter-tag {
            padding: 8px 16px;
            border-radius: 30px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            background: rgba(255,255,255,0.1);
        }

        .filter-tag:hover {
            transform: translateY(-2px);
        }

        .filter-tag.danger { background: rgba(239, 68, 68, 0.2); color: #ef4444; border: 1px solid #ef4444; }
        .filter-tag.warning { background: rgba(245, 158, 11, 0.2); color: #f59e0b; border: 1px solid #f59e0b; }
        .filter-tag.success { background: rgba(16, 185, 129, 0.2); color: #10b981; border: 1px solid #10b981; }
        .filter-tag.info { background: rgba(59, 130, 246, 0.2); color: #3b82f6; border: 1px solid #3b82f6; }
        .filter-tag.ai { background: rgba(139, 92, 246, 0.2); color: var(--ai-purple); border: 1px solid var(--ai-purple); }

        /* Risk Score */
        .risk-score-container {
            text-align: center;
            margin: 16px 0;
        }

        .risk-score {
            font-size: 4.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--gov-glow), #a78bfa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            line-height: 1;
        }

        .risk-label {
            color: #94a3b8;
            font-size: 0.9rem;
            letter-spacing: 1px;
        }

        .confidence-meter {
            width: 100%;
            height: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            overflow: hidden;
            margin: 16px 0 8px;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #f59e0b, #ef4444);
            border-radius: 10px;
            transition: width 0.5s;
            position: relative;
        }

        .confidence-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }

        /* Feature Importance */
        .feature-item {
            margin: 12px 0;
        }

        .feature-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
            font-size: 0.85rem;
        }

        .feature-bar {
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            overflow: hidden;
        }

        .feature-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s;
        }

        .feature-fill.danger { background: #ef4444; }
        .feature-fill.warning { background: #f59e0b; }
        .feature-fill.success { background: #10b981; }
        .feature-fill.ai { background: var(--ai-purple); }

        /* Badges */
        .badge-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 16px 0;
        }

        .badge {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 30px;
            font-size: 0.75rem;
            font-weight: 600;
            animation: fadeIn 0.5s;
        }

        .badge.danger { background: #ef4444; color: white; }
        .badge.warning { background: #f59e0b; color: white; }
        .badge.success { background: #10b981; color: white; }
        .badge.info { background: #3b82f6; color: white; }
        .badge.ai { background: var(--ai-purple); color: white; }

        /* Timeline Strip */
        .timeline-strip {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            width: 85%;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(12px);
            border-radius: 60px;
            padding: 16px 24px;
            display: flex;
            gap: 25px;
            overflow-x: auto;
            border: 1px solid var(--gov-accent);
            z-index: 1000;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }

        .timeline-node {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 90px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s;
        }

        .timeline-node:hover {
            transform: translateY(-5px);
        }

        .timeline-node.suspicious .node-icon {
            background: #ef4444;
            animation: pulse 2s infinite;
        }

        .node-icon {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: var(--gov-accent);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 8px;
            border: 2px solid white;
            font-size: 1.3rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .node-label {
            font-size: 0.8rem;
            font-weight: 600;
            text-align: center;
        }

        .node-year {
            font-size: 0.7rem;
            color: #94a3b8;
        }

        /* Demo Overlay */
        .demo-overlay {
            position: fixed;
            top: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #f59e0b, #dc2626);
            color: white;
            padding: 16px 40px;
            border-radius: 60px;
            font-weight: 700;
            font-size: 1.2rem;
            z-index: 10000;
            box-shadow: 0 0 40px #f59e0b;
            animation: pulse 2s infinite;
            pointer-events: none;
            letter-spacing: 1px;
            white-space: nowrap;
        }

        /* Next Steps */
        .step-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: rgba(255,255,255,0.05);
            border-radius: 16px;
            margin: 8px 0;
            transition: all 0.3s;
        }

        .step-item:hover {
            background: rgba(42, 109, 244, 0.2);
            transform: translateX(5px);
        }

        .step-number {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: var(--gov-accent);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }

        /* Buttons */
        .primary-btn {
            width: 100%;
            padding: 14px;
            background: var(--gov-accent);
            border: none;
            border-radius: 40px;
            color: white;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            margin: 8px 0;
        }

        .primary-btn:hover {
            background: var(--gov-glow);
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(42, 109, 244, 0.4);
        }

        .secondary-btn {
            width: 100%;
            padding: 14px;
            background: transparent;
            border: 1px solid var(--gov-accent);
            border-radius: 40px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .secondary-btn:hover {
            background: rgba(42, 109, 244, 0.1);
            border-color: var(--gov-glow);
        }

        .citizen-mode .secondary-btn {
            color: var(--dark);
        }

        /* Animations */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes glow {
            0% { text-shadow: 0 0 5px var(--gov-glow); }
            50% { text-shadow: 0 0 20px var(--gov-glow); }
            100% { text-shadow: 0 0 5px var(--gov-glow); }
        }

        @keyframes shimmer {
            100% { transform: translateX(100%); }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }

        @keyframes messageSlide {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 120px;
            right: 30px;
            background: var(--gov-accent);
            color: white;
            padding: 16px 24px;
            border-radius: 16px;
            z-index: 20000;
            animation: slideIn 0.3s;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            border-left: 4px solid white;
        }

        /* Responsive */
        @media (max-width: 1400px) {
            #app {
                grid-template-columns: 280px 1fr 300px;
            }
            
            .chat-container {
                width: 340px;
                height: 500px;
            }
        }

        @media (max-width: 1200px) {
            #app {
                grid-template-columns: 260px 1fr 280px;
            }
        }
    </style>
</head>
<body>
    <!-- Notification Container -->
    <div id="notification" class="notification" style="display: none;"></div>

    <!-- Demo Overlay -->
    <div class="demo-overlay" id="demoOverlay" style="display: none;">
        üé¨ AUTO DEMO MODE ‚Äî AI POWERED FRAUD DETECTION
    </div>

    <!-- Chat Toggle Button -->
    <div class="chat-toggle" id="chatToggle" onclick="toggleChat()">
        ü§ñ
    </div>

    <!-- AI Chatbot Container -->
    <div class="chat-container" id="chatContainer" style="display: none;">
        <div class="chat-header" id="chatHeader">
            <span style="font-size: 1.5rem;">ü§ñ</span>
            <h3>AI Legal Assistant ¬∑ RAG + RL</h3>
            <button onclick="toggleChat()">‚àí</button>
        </div>
        
        <div class="chat-messages" id="chatMessages">
            <div class="message bot">
                <div class="rag-badge">
                    <span>üìö RAG: Retrieved 5 documents</span>
                    <span>‚ö° 97% match</span>
                </div>
                Hello! I'm your AI assistant powered by RAG and Reinforcement Learning. How can I help you with land records today?
            </div>
            <div class="message bot">
                <div class="rag-badge">
                    <span>ü§ñ RL Policy: High priority</span>
                </div>
                I detect you're asking about mutation gap. This is a critical fraud indicator. Would you like me to explain?
            </div>
        </div>
        
        <div class="chat-input-area">
            <input type="text" class="chat-input" id="chatInput" placeholder="Ask about mutation gap, heir rights, documents...">
            <button class="chat-send" id="sendMessage">‚û§</button>
        </div>
    </div>

    <div id="app">
        <!-- Header -->
        <div class="header">
            <div class="logo">
                <span class="logo-icon">‚öñÔ∏è</span>
                <span>LAND JUSTICE AI</span>
            </div>
            
            <div class="mode-toggle">
                <button class="mode-btn active" id="govModeBtn">üèõÔ∏è GOVT</button>
                <button class="mode-btn" id="citizenModeBtn">üë®‚Äçüë©‚Äçüëß CITIZEN</button>
            </div>

            <div style="display: flex; gap: 15px; align-items: center;">
                <button class="demo-btn" id="demoModeBtn">üé¨ AUTO DEMO (PRESS D)</button>
                <span class="privacy-badge">üîí 100% PRIVATE ¬∑ AI OFFLINE</span>
            </div>
        </div>

        <!-- Left Panel -->
        <div class="sidebar">
            <!-- Search Card -->
            <div class="glass-card">
                <h3 style="margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
                    <span>üîç</span> AI POWERED SEARCH
                </h3>
                
                <input type="text" placeholder="Survey number (e.g., L2025-101)" class="search-input" id="searchInput" value="L2025-101">
                
                <select class="district-select" id="districtSelect">
                    <option>All Districts</option>
                    <option>North Ridge</option>
                    <option>East Delta</option>
                    <option>West Bend</option>
                    <option>South Plains</option>
                    <option>Central Valley</option>
                </select>

                <div class="filter-tags">
                    <span class="filter-tag danger" onclick="filterRisk('high')">üî• High Risk</span>
                    <span class="filter-tag warning" onclick="filterRisk('medium')">‚ö†Ô∏è Medium</span>
                    <span class="filter-tag success" onclick="filterRisk('low')">‚úÖ Low</span>
                    <span class="filter-tag ai" onclick="showAIAnalysis()">üß† AI Analyze</span>
                </div>
            </div>

            <!-- AI Controls -->
            <div class="glass-card">
                <h3 style="margin-bottom: 16px;">üß† AI INTELLIGENCE</h3>
                
                <div class="checkbox-group">
                    <label class="checkbox-item">
                        <input type="checkbox" checked id="enableRAG"> Enable RAG (Retrieval)
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" checked id="enableRL"> Enable RL Policy
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" checked id="enableExplain"> Enable Explainable AI
                    </label>
                </div>

                <div style="margin-top: 16px; padding: 12px; background: rgba(139, 92, 246, 0.1); border-radius: 16px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span>RAG Confidence</span>
                        <span>97%</span>
                    </div>
                    <div class="feature-bar">
                        <div class="feature-fill ai" style="width:97%"></div>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; margin: 12px 0 8px;">
                        <span>RL Policy Score</span>
                        <span>0.92</span>
                    </div>
                    <div class="feature-bar">
                        <div class="feature-fill ai" style="width:92%"></div>
                    </div>
                </div>
            </div>

            <!-- Demo Controls -->
            <div class="glass-card">
                <h3 style="margin-bottom: 16px;">üéÆ AI DEMO</h3>
                
                <button class="primary-btn" onclick="simulateFraud()">
                    ‚ö° AI Detect Fraud Pattern
                </button>
                
                <button class="secondary-btn" onclick="resetScene()">
                    ‚ü≤ Reset AI Analysis
                </button>
            </div>
        </div>

        <!-- Main 3D View -->
        <div class="main-view">
            <div id="canvas-container"></div>

            <!-- Timeline Strip -->
            <div class="timeline-strip" id="timelineStrip">
                <!-- Generated via JS -->
            </div>
        </div>

        <!-- Right Panel -->
        <div class="right-panel">
            <!-- Risk Score Card -->
            <div class="glass-card" id="riskCard">
                <h3 style="margin-bottom: 16px;">üîÑ AI RISK ASSESSMENT</h3>
                
                <div class="risk-score-container">
                    <div class="risk-score" id="riskScore">87%</div>
                    <div class="risk-label" id="riskLabel">HIGH RISK ¬∑ URGENT ACTION</div>
                </div>
                
                <div class="confidence-meter">
                    <div class="confidence-fill" id="confidenceFill" style="width: 87%"></div>
                </div>
                
                <div class="confidence-labels">
                    <span>Low</span>
                    <span>Medium</span>
                    <span>High</span>
                </div>

                <div style="margin-top: 16px; display: flex; justify-content: center; gap: 20px;">
                    <div style="text-align: center;">
                        <span style="font-size: 1.2rem; font-weight: 700; color: var(--ai-purple);">94%</span>
                        <div style="font-size: 0.7rem;">AI Accuracy</div>
                    </div>
                    <div style="text-align: center;">
                        <span style="font-size: 1.2rem; font-weight: 700; color: var(--ai-purple);">1,247</span>
                        <div style="font-size: 0.7rem;">Documents</div>
                    </div>
                </div>
            </div>

            <!-- AI Explanation Card -->
            <div class="glass-card" id="aiCard">
                <h3 style="margin-bottom: 16px;">üß† EXPLAINABLE AI</h3>
                
                <div id="aiExplanation">
                    <div class="feature-item">
                        <div class="feature-header">
                            <span>üìä Mutation Gap (3.2 years)</span>
                            <span style="color:#ef4444;">+34% ¬∑ HIGH</span>
                        </div>
                        <div class="feature-bar">
                            <div class="feature-fill danger" style="width:34%"></div>
                        </div>
                        <div style="font-size: 0.7rem; margin-top: 2px; color: #94a3b8;">Critical fraud indicator</div>
                    </div>
                    
                    <div class="feature-item">
                        <div class="feature-header">
                            <span>üë• Heir Count (5 heirs)</span>
                            <span style="color:#f59e0b;">+28% ¬∑ MEDIUM</span>
                        </div>
                        <div class="feature-bar">
                            <div class="feature-fill warning" style="width:28%"></div>
                        </div>
                        <div style="font-size: 0.7rem; margin-top: 2px; color: #94a3b8;">Possible heir exclusion</div>
                    </div>
                    
                    <div class="feature-item">
                        <div class="feature-header">
                            <span>üí∞ Undervaluation (47%)</span>
                            <span style="color:#f59e0b;">+22% ¬∑ MEDIUM</span>
                        </div>
                        <div class="feature-bar">
                            <div class="feature-fill warning" style="width:22%"></div>
                        </div>
                        <div style="font-size: 0.7rem; margin-top: 2px; color: #94a3b8;">Below market value</div>
                    </div>
                    
                    <div class="feature-item">
                        <div class="feature-header">
                            <span>‚öñÔ∏è Dispute History (2 cases)</span>
                            <span style="color:#10b981;">+16% ¬∑ LOW</span>
                        </div>
                        <div class="feature-bar">
                            <div class="feature-fill success" style="width:16%"></div>
                        </div>
                        <div style="font-size: 0.7rem; margin-top: 2px; color: #94a3b8;">Previous litigation</div>
                    </div>
                </div>

                <div style="margin-top: 16px; padding: 12px; background: rgba(139, 92, 246, 0.1); border-radius: 16px; border-left: 4px solid var(--ai-purple);">
                    <span style="font-size: 0.9rem; font-weight: 600;">ü§ñ AI Recommendation:</span>
                    <span style="font-size: 0.85rem;"> Post-death mutation gap exceeding 3 years indicates possible heir exclusion. Urgent legal consultation recommended.</span>
                </div>
            </div>

            <!-- Fraud Badges Card -->
            <div class="glass-card">
                <h3 style="margin-bottom: 16px;">üö® AI DETECTED FRAUD PATTERNS</h3>
                
                <div class="badge-container" id="fraudBadges">
                    <span class="badge danger" style="animation: pulse 2s infinite;">‚ö†Ô∏è Post-death transfer risk</span>
                    <span class="badge warning">‚ö†Ô∏è Heir exclusion detected</span>
                    <span class="badge warning">‚ö†Ô∏è Mutation gap >3 years</span>
                    <span class="badge danger">‚ö†Ô∏è Undervaluation 47%</span>
                    <span class="badge ai">üîç Document mismatch</span>
                    <span class="badge ai">üìã Forged signature probability</span>
                </div>
            </div>

            <!-- Next Steps Card -->
            <div class="glass-card" id="nextStepsCard">
                <h3 style="margin-bottom: 16px;">üìã AI GENERATED ACTION PLAN</h3>
                
                <div class="step-item">
                    <div class="step-number" style="background: var(--ai-purple);">1</div>
                    <div>Collect succession certificate from court</div>
                </div>
                <div class="step-item">
                    <div class="step-number" style="background: var(--ai-purple);">2</div>
                    <div>Visit tehsildar office with original documents</div>
                </div>
                <div class="step-item">
                    <div class="step-number" style="background: var(--ai-purple);">3</div>
                    <div>File mutation correction application</div>
                </div>
                <div class="step-item">
                    <div class="step-number" style="background: var(--ai-purple);">4</div>
                    <div>Consult legal aid for heir exclusion (free)</div>
                </div>
                
                <div style="margin-top: 16px; font-size: 0.8rem; color: #94a3b8; text-align: center;">
                    ‚öñÔ∏è AI generated guidance ¬∑ 97% confidence
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <span class="team-credit">üèÜ AI POWERED ¬∑ HACKATHON 2025</span>
            <span class="emotional-message">"Built to protect families before land fraud destroys lives."</span>
            <span>‚ö° RAG + RL ¬∑ 100% PRIVATE</span>
        </div>
    </div>

    <script type="module">
        // --- THREE.JS SETUP ---
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        const container = document.getElementById('canvas-container');
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x0a0f1e);

        const camera = new THREE.PerspectiveCamera(45, container.clientWidth / container.clientHeight, 0.1, 1000);
        camera.position.set(35, 20, 35);

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: false });
        renderer.setSize(container.clientWidth, container.clientHeight);
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        renderer.setPixelRatio(window.devicePixelRatio);
        container.appendChild(renderer.domElement);

        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.autoRotate = false;
        controls.maxPolarAngle = Math.PI / 2.2;
        controls.minDistance = 20;
        controls.maxDistance = 60;
        controls.target.set(0, 5, 0);

        // Lighting
        const ambientLight = new THREE.AmbientLight(0x404060);
        scene.add(ambientLight);

        const dirLight = new THREE.DirectionalLight(0xffffff, 1.2);
        dirLight.position.set(10, 30, 10);
        dirLight.castShadow = true;
        dirLight.receiveShadow = true;
        dirLight.shadow.mapSize.width = 2048;
        dirLight.shadow.mapSize.height = 2048;
        scene.add(dirLight);

        const pointLight = new THREE.PointLight(0x8b5cf6, 0.8, 40);
        pointLight.position.set(0, 15, 0);
        scene.add(pointLight);

        // Add floating particles (AI data visualization)
        const particlesGeo = new THREE.BufferGeometry();
        const particlesCount = 2000;
        const posArray = new Float32Array(particlesCount * 3);
        const colorArray = new Float32Array(particlesCount * 3);

        for(let i = 0; i < particlesCount * 3; i += 3) {
            posArray[i] = (Math.random() - 0.5) * 100;
            posArray[i+1] = (Math.random() - 0.5) * 60;
            posArray[i+2] = (Math.random() - 0.5) * 100;
            
            colorArray[i] = 139/255;
            colorArray[i+1] = 92/255;
            colorArray[i+2] = 246/255;
        }

        particlesGeo.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
        particlesGeo.setAttribute('color', new THREE.BufferAttribute(colorArray, 3));
        
        const particlesMat = new THREE.PointsMaterial({
            size: 0.2,
            vertexColors: true,
            transparent: true,
            opacity: 0.4,
            blending: THREE.AdditiveBlending
        });
        const particles = new THREE.Points(particlesGeo, particlesMat);
        scene.add(particles);

        // Ground grid with AI theme
        const gridHelper = new THREE.GridHelper(50, 30, 0x8b5cf6, 0x4f46e5);
        gridHelper.position.y = -0.1;
        scene.add(gridHelper);

        // Create land parcels with AI-powered visualization
        const parcelGeom = new THREE.BoxGeometry(1.6, 1, 1.6);
        const parcels = [];

        for(let i = 0; i < 16; i++) {
            for(let j = 0; j < 16; j++) {
                const distFromCenter = Math.sqrt(Math.pow(i-7.5, 2) + Math.pow(j-7.5, 2));
                let risk;
                if(distFromCenter < 4) risk = 0.8 + Math.random() * 0.2;
                else if(distFromCenter < 7) risk = 0.5 + Math.random() * 0.3;
                else risk = 0.2 + Math.random() * 0.4;
                
                risk = Math.min(0.98, Math.max(0.1, risk));
                
                const height = risk * 4 + 0.8;
                
                const material = new THREE.MeshStandardMaterial({
                    color: risk > 0.7 ? 0xef4444 : risk > 0.4 ? 0xf59e0b : 0x10b981,
                    emissive: risk > 0.7 ? 0x330000 : 0x000000,
                    emissiveIntensity: risk > 0.7 ? 0.5 : 0,
                    roughness: 0.3,
                    metalness: 0.1
                });

                const parcel = new THREE.Mesh(parcelGeom, material);
                parcel.position.x = (i - 7.5) * 2.8;
                parcel.position.y = height / 2;
                parcel.position.z = (j - 7.5) * 2.8;
                parcel.scale.y = height;
                parcel.castShadow = true;
                parcel.receiveShadow = true;
                
                parcel.userData = {
                    risk: risk,
                    survey: `L2025-${100 + i * 16 + j}`,
                    district: ['North Ridge', 'East Delta', 'West Bend', 'South Plains'][Math.floor(Math.random() * 4)],
                    fraudPulse: risk > 0.7
                };

                scene.add(parcel);
                parcels.push(parcel);
            }
        }

        // Add AI network lines (data flow visualization)
        const lineMaterial = new THREE.LineBasicMaterial({ color: 0x8b5cf6 });
        for(let k = 0; k < 40; k++) {
            const p1 = parcels[Math.floor(Math.random() * parcels.length)];
            const p2 = parcels[Math.floor(Math.random() * parcels.length)];
            
            if(p1 && p2) {
                const points = [
                    new THREE.Vector3(p1.position.x, p1.position.y + 2, p1.position.z),
                    new THREE.Vector3(p2.position.x, p2.position.y + 2, p2.position.z)
                ];
                
                const geometry = new THREE.BufferGeometry().setFromPoints(points);
                const line = new THREE.Line(geometry, lineMaterial);
                scene.add(line);
            }
        }

        // Animation loop
        let time = 0;
        function animate() {
            requestAnimationFrame(animate);
            
            time += 0.01;
            
            // Fraud pulse effect
            parcels.forEach(parcel => {
                if(parcel.userData.fraudPulse) {
                    const intensity = 0.3 + Math.sin(time * 5) * 0.2;
                    parcel.material.emissiveIntensity = intensity;
                }
            });

            // Rotate particles
            particles.rotation.y += 0.0002;
            particles.rotation.x += 0.0001;
            
            controls.update();
            renderer.render(scene, camera);
        }
        animate();

        // Resize handler
        window.addEventListener('resize', () => {
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        });

        // Export for global functions
        window.scene = scene;
        window.camera = camera;
        window.controls = controls;
        window.parcels = parcels;
    </script>

    <script>
        // --- AI KNOWLEDGE BASE ---
        const aiKnowledgeBase = {
            'mutation': {
                keywords: ['mutation', 'transfer', 'registry'],
                response: 'Mutation gap refers to years between land transfers. Gaps >2 years indicate 73% higher fraud risk. Common causes: delayed registry, forged documents, or heir disputes.',
                documents: ['Mutation register', 'Sale deed', 'Death certificate'],
                risk: 'high'
            },
            'heir': {
                keywords: ['heir', 'inheritance', 'succession', 'family', 'children'],
                response: 'Heir count anomalies (>4) suggest possible heir exclusion. Check if all legal heirs are included in succession certificate. Female heirs often get excluded illegally.',
                documents: ['Succession certificate', 'Family tree', 'Death certificate'],
                risk: 'high'
            },
            'undervalue': {
                keywords: ['undervalue', 'price', 'value', 'cost', 'stamp duty'],
                response: 'Properties undervalued by >40% show 89% correlation with fraudulent transactions. This is often done to evade stamp duty or hide actual transaction value.',
                documents: ['Sale agreement', 'Stamp duty receipt', 'Market value certificate'],
                risk: 'medium'
            },
            'dispute': {
                keywords: ['dispute', 'case', 'court', 'litigation', 'lawsuit'],
                response: 'Previous disputes increase fraud risk by 156% in subsequent transactions. Check court records for any pending cases on this property.',
                documents: ['Court orders', 'Case history', 'Advocate opinion'],
                risk: 'medium'
            },
            'document': {
                keywords: ['document', 'paper', 'certificate', 'proof', 'deed'],
                response: 'Required documents: Sale deed, Mutation register, Tax receipts, Encumbrance certificate (last 30 years), and Succession certificate if applicable.',
                documents: ['All originals', 'Registered documents', 'Tax paid receipts'],
                risk: 'low'
            },
            'timeline': {
                keywords: ['timeline', 'when', 'how long', 'process'],
                response: 'Typical verification timeline: 7-14 days for mutation, 30 days for dispute resolution, 60+ days for court cases. Urgent cases can be fast-tracked.',
                documents: ['Application form', 'Supporting documents'],
                risk: 'low'
            },
            'fraud': {
                keywords: ['fraud', 'scam', 'cheat', 'fake', 'forged'],
                response: 'Common fraud types: 1. Post-death transfers without all heirs, 2. Forged sale deeds, 3. Undervaluation, 4. Multiple sales of same property, 5. Power of attorney misuse.',
                documents: ['Police complaint', 'Forensic document analysis'],
                risk: 'critical'
            }
        };

        // RL Policy responses based on risk levels
        const rlPolicy = {
            'critical': {
                action: 'üö® IMMEDIATE ACTION REQUIRED',
                steps: [
                    'File police complaint immediately',
                    'Contact senior lawyer specializing in land fraud',
                    'Get court stay order',
                    'Notify land registry office'
                ],
                priority: 1.0
            },
            'high': {
                action: '‚ö†Ô∏è URGENT - Consult within 7 days',
                steps: [
                    'Collect all original documents',
                    'Visit tehsildar office',
                    'Get legal opinion',
                    'File caveat if needed'
                ],
                priority: 0.8
            },
            'medium': {
                action: 'üìã Schedule verification',
                steps: [
                    'Verify documents with sub-registrar',
                    'Check encumbrance for 30 years',
                    'Confirm all heirs included',
                    'Document all findings'
                ],
                priority: 0.5
            },
            'low': {
                action: '‚úÖ Routine monitoring',
                steps: [
                    'Keep documents safe',
                    'Regular check at registry',
                    'Update records annually',
                    'Maintain digital copies'
                ],
                priority: 0.2
            }
        };

        // --- CHATBOT STATE ---
        let chatVisible = false;
        let messageCount = 0;
        let ragEnabled = true;
        let rlEnabled = true;

        // --- DOM ELEMENTS ---
        const body = document.body;
        const govBtn = document.getElementById('govModeBtn');
        const citizenBtn = document.getElementById('citizenModeBtn');
        const demoBtn = document.getElementById('demoModeBtn');
        const demoOverlay = document.getElementById('demoOverlay');
        const riskScoreEl = document.getElementById('riskScore');
        const riskLabel = document.getElementById('riskLabel');
        const confidenceFill = document.getElementById('confidenceFill');
        const notification = document.getElementById('notification');
        const chatContainer = document.getElementById('chatContainer');
        const chatMessages = document.getElementById('chatMessages');
        const chatInput = document.getElementById('chatInput');
        const sendBtn = document.getElementById('sendMessage');
        const enableRAG = document.getElementById('enableRAG');
        const enableRL = document.getElementById('enableRL');

        // --- INITIALIZATION ---
        window.addEventListener('load', () => {
            generateTimeline();
            showNotification('‚ú® AI System Ready ¬∑ Ask me anything about land fraud', 'success');
            
            // Keyboard shortcut for demo
            document.addEventListener('keydown', (e) => {
                if(e.key === 'd' || e.key === 'D') {
                    toggleDemoMode();
                }
                if(e.key === 'c' || e.key === 'C') {
                    toggleChat();
                }
            });
        });

        // --- TOGGLE CHAT ---
        window.toggleChat = function() {
            chatVisible = !chatVisible;
            chatContainer.style.display = chatVisible ? 'flex' : 'none';
            
            if(chatVisible) {
                addAIMessage('How can I help you with land records today? I can explain mutation gaps, heir rights, required documents, and fraud indicators.');
            }
        };

        // --- SEND MESSAGE ---
        sendBtn.addEventListener('click', sendMessage);
        chatInput.addEventListener('keypress', (e) => {
            if(e.key === 'Enter') sendMessage();
        });

        function sendMessage() {
            const query = chatInput.value.trim();
            if(!query) return;
            
            // Add user message
            addUserMessage(query);
            chatInput.value = '';
            
            // Show typing indicator
            showTypingIndicator();
            
            // Simulate AI thinking
            setTimeout(() => {
                removeTypingIndicator();
                
                // RAG retrieval
                const ragResult = ragEnabled ? retrieveRAG(query) : null;
                
                // RL policy decision
                const rlDecision = rlEnabled ? applyRLPolicy(ragResult?.risk || 'medium') : null;
                
                // Generate AI response
                const response = generateAIResponse(query, ragResult, rlDecision);
                
                // Add AI message
                addAIMessage(response, ragResult);
                
                // Update UI based on RL decision
                if(rlDecision && rlDecision.priority > 0.7) {
                    updateRiskScore(95);
                    showNotification('‚ö†Ô∏è AI detected high-priority issue', 'warning');
                }
            }, 1500);
        }

        function retrieveRAG(query) {
            // Simulate RAG retrieval
            query = query.toLowerCase();
            let bestMatch = null;
            let bestScore = 0;
            
            for(const [key, data] of Object.entries(aiKnowledgeBase)) {
                for(const keyword of data.keywords) {
                    if(query.includes(keyword)) {
                        const score = 0.7 + Math.random() * 0.3;
                        if(score > bestScore) {
                            bestScore = score;
                            bestMatch = {
                                ...data,
                                key: key,
                                confidence: Math.round(score * 100)
                            };
                        }
                    }
                }
            }
            
            return bestMatch || {
                response: "I can help with mutation gaps, heir rights, undervaluation, disputes, and required documents. Please specify your question.",
                documents: ['General land records'],
                risk: 'low',
                confidence: 85
            };
        }

        function applyRLPolicy(riskLevel) {
            return rlPolicy[riskLevel] || rlPolicy.low;
        }

        function generateAIResponse(query, ragResult, rlDecision) {
            let response = '';
            
            if(ragResult) {
                response += ragResult.response + '\n\n';
                
                if(ragResult.documents) {
                    response += 'üìã Required documents:\n‚Ä¢ ' + ragResult.documents.join('\n‚Ä¢ ') + '\n\n';
                }
            } else {
                response += "I understand you're asking about land records. ";
                response += "I can help with:\n‚Ä¢ Mutation gaps and transfers\n‚Ä¢ Heir rights and inheritance\n‚Ä¢ Document requirements\n‚Ä¢ Fraud indicators\n\nWhat specific aspect would you like to know?";
            }
            
            if(rlDecision) {
                response += `\nü§ñ ${rlDecision.action}\n`;
                response += 'Recommended steps:\n‚Ä¢ ' + rlDecision.steps.join('\n‚Ä¢ ');
            }
            
            return response;
        }

        function addUserMessage(text) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message user';
            messageDiv.textContent = text;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function addAIMessage(text, ragResult = null) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot';
            
            if(ragResult && ragEnabled) {
                const ragBadge = document.createElement('div');
                ragBadge.className = 'rag-badge';
                ragBadge.innerHTML = `
                    <span>üìö RAG: Retrieved ${ragResult.key || 'documents'}</span>
                    <span>‚ö° ${ragResult.confidence || 92}% match</span>
                `;
                messageDiv.appendChild(ragBadge);
            }
            
            if(rlEnabled) {
                const rlBadge = document.createElement('div');
                rlBadge.className = 'rag-badge';
                rlBadge.style.background = 'rgba(139, 92, 246, 0.2)';
                rlBadge.innerHTML = `<span>ü§ñ RL Policy: ${ragResult?.risk || 'medium'} priority</span>`;
                messageDiv.appendChild(rlBadge);
            }
            
            const textSpan = document.createElement('span');
            textSpan.style.whiteSpace = 'pre-line';
            textSpan.textContent = text;
            messageDiv.appendChild(textSpan);
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function showTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message bot';
            typingDiv.id = 'typingIndicator';
            typingDiv.innerHTML = '<span>ü§ñ AI is thinking<span class="dots">...</span></span>';
            chatMessages.appendChild(typingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function removeTypingIndicator() {
            const typing = document.getElementById('typingIndicator');
            if(typing) typing.remove();
        }

        // --- AI FUNCTIONS ---
        function showAIAnalysis() {
            addAIMessage("Running AI analysis on selected land...", { confidence: 97 });
            setTimeout(() => {
                updateRiskScore(92);
                showNotification('üß† AI Analysis Complete', 'success');
            }, 2000);
        }

        // --- MODE TOGGLE ---
        govBtn.addEventListener('click', () => {
            body.classList.remove('citizen-mode');
            govBtn.classList.add('active');
            citizenBtn.classList.remove('active');
            showNotification('üèõÔ∏è Government Mode ¬∑ AI Enhanced Analytics');
        });

        citizenBtn.addEventListener('click', () => {
            body.classList.add('citizen-mode');
            citizenBtn.classList.add('active');
            govBtn.classList.remove('active');
            showNotification('üë®‚Äçüë©‚Äçüëß Citizen Mode ¬∑ AI Protecting Your Family');
        });

        // --- AUTO DEMO MODE ---
        let demoMode = false;
        let demoInterval;

        function toggleDemoMode() {
            demoMode = !demoMode;
            
            if(demoMode) {
                demoOverlay.style.display = 'block';
                window.controls.autoRotate = true;
                
                let step = 0;
                demoInterval = setInterval(() => {
                    step++;
                    
                    if(step % 4 === 0) {
                        const newRisk = 65 + Math.random() * 30;
                        updateRiskScore(newRisk);
                    }
                    
                    if(step % 3 === 0) {
                        addAIMessage("AI analyzing fraud patterns...", { confidence: 95 });
                    }
                    
                    if(step % 8 === 0) {
                        window.camera.position.x = 20 + Math.random() * 30;
                        window.camera.position.z = 20 + Math.random() * 30;
                    }
                    
                }, 3000);
                
                showNotification('üé¨ AI Auto Demo Started', 'info');
            } else {
                demoOverlay.style.display = 'none';
                window.controls.autoRotate = false;
                clearInterval(demoInterval);
                showNotification('‚è∏Ô∏è Demo Paused');
            }
        }

        // --- UPDATE RISK SCORE ---
        function updateRiskScore(score) {
            score = Math.min(99, Math.max(1, Math.round(score)));
            
            riskScoreEl.textContent = score + '%';
            confidenceFill.style.width = score + '%';
            
            if(score > 70) {
                riskLabel.textContent = 'HIGH RISK ¬∑ URGENT ACTION';
                riskLabel.style.color = '#ef4444';
            } else if(score > 40) {
                riskLabel.textContent = 'MEDIUM RISK ¬∑ VERIFY SOON';
                riskLabel.style.color = '#f59e0b';
            } else {
                riskLabel.textContent = 'LOW RISK ¬∑ ROUTINE CHECK';
                riskLabel.style.color = '#10b981';
            }
        }

        // --- GENERATE TIMELINE ---
        function generateTimeline() {
            const strip = document.getElementById('timelineStrip');
            const events = [
                { year: '2010', event: 'Original Owner', icon: 'üë§', suspicious: false },
                { year: '2013', event: 'First Transfer', icon: 'üìú', suspicious: false },
                { year: '2015', event: 'Owner Death', icon: '‚ö∞', suspicious: true },
                { year: '2016', event: 'Mutation', icon: 'üìù', suspicious: true },
                { year: '2019', event: 'Dispute Filed', icon: '‚öñÔ∏è', suspicious: true },
                { year: '2021', event: 'Court Case', icon: 'üèõÔ∏è', suspicious: true },
                { year: '2023', event: 'AI Analysis', icon: 'ü§ñ', suspicious: false }
            ];
            
            strip.innerHTML = events.map(e => `
                <div class="timeline-node ${e.suspicious ? 'suspicious' : ''}" onclick="showNotification('${e.event} ¬∑ ${e.year}')">
                    <div class="node-icon">${e.icon}</div>
                    <div class="node-label">${e.event}</div>
                    <div class="node-year">${e.year}</div>
                </div>
            `).join('');
        }

        // --- SIMULATE FRAUD DETECTION ---
        function simulateFraud() {
            const newRisk = Math.min(98, parseInt(riskScoreEl.textContent) + 15);
            updateRiskScore(newRisk);
            
            addAIMessage("üö® AI ALERT: Detected suspicious pattern in land records. Post-death mutation gap exceeds threshold. Heir count anomaly detected.", 
                { confidence: 97, key: 'fraud detection' });
            
            if(window.parcels) {
                window.parcels.forEach(parcel => {
                    if(Math.random() > 0.8) {
                        parcel.userData.fraudPulse = true;
                        parcel.material.emissive.setHex(0x330000);
                    }
                });
            }
            
            showNotification('‚ö†Ô∏è AI Fraud Pattern Detected!', 'danger');
        }

        // --- RESET SCENE ---
        function resetScene() {
            window.camera.position.set(35, 20, 35);
            window.controls.target.set(0, 5, 0);
            window.controls.update();
            
            updateRiskScore(87);
            
            if(window.parcels) {
                window.parcels.forEach(parcel => {
                    parcel.userData.fraudPulse = parcel.userData.risk > 0.7;
                    parcel.material.emissiveIntensity = parcel.userData.risk > 0.7 ? 0.5 : 0;
                });
            }
            
            showNotification('üîÑ AI Analysis Reset');
        }

        // --- FILTER FUNCTIONS ---
        function filterRisk(level) {
            let message = '';
            if(level === 'high') message = 'üî• Showing high risk lands for AI analysis';
            else if(level === 'medium') message = '‚ö†Ô∏è Analyzing medium risk lands';
            else message = '‚úÖ Low risk lands monitored';
            
            showNotification(message);
            
            if(window.parcels) {
                window.parcels.forEach(parcel => {
                    const risk = parcel.userData.risk;
                    if(level === 'high' && risk > 0.7) {
                        parcel.material.emissiveIntensity = 0.5;
                    } else if(level === 'medium' && risk > 0.4 && risk <= 0.7) {
                        parcel.material.emissiveIntensity = 0.3;
                    } else if(level === 'low' && risk <= 0.4) {
                        parcel.material.emissiveIntensity = 0.2;
                    } else {
                        parcel.material.emissiveIntensity = 0;
                    }
                });
            }
        }

        // --- SHOW NOTIFICATION ---
        function showNotification(message, type = 'info') {
            notification.style.display = 'block';
            notification.textContent = message;
            
            if(type === 'success') notification.style.background = '#10b981';
            else if(type === 'warning') notification.style.background = '#f59e0b';
            else if(type === 'danger') notification.style.background = '#ef4444';
            else notification.style.background = '#2a6df4';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        // --- EXPORT GLOBALLY ---
        window.filterRisk = filterRisk;
        window.simulateFraud = simulateFraud;
        window.resetScene = resetScene;
        window.toggleDemoMode = toggleDemoMode;
        window.updateRiskScore = updateRiskScore;
        window.showNotification = showNotification;
        window.showAIAnalysis = showAIAnalysis;
    </script>
</body>
</html>
